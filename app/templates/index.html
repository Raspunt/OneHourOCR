<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OCR сервис</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4 text-center">Загрузка изображения для OCR</h2>

    <form id="ocr-form" class="card p-4 shadow-sm" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="file" class="form-label">Выберите изображение:</label>
            <input class="form-control" type="file" name="file" id="file" accept="image/*" required>
        </div>

        <!-- Превью -->
        <div class="mb-3 text-center">
            <img id="preview" src="#" alt="Превью изображения" class="img-fluid rounded shadow-sm d-none" style="max-height: 300px;">
        </div>

        <div class="mb-3">
            <label for="lang" class="form-label">Язык распознавания:</label>
            <select class="form-select" name="lang" id="lang">
                <option value="rus" selected>Русский</option>
                <option value="eng">Английский</option>
                <option value="rus+eng">Русский + Английский</option>
                <option value="deu">Немецкий</option>
                <option value="fra">Французский</option>
                <option value="spa">Испанский</option>
            </select>
        </div>

        <button class="btn btn-primary w-100" type="submit">Распознать</button>
    </form>

    <!-- блок результата -->
    <div id="result" class="card mt-4 shadow-sm d-none">
        <div class="card-body">
            <h5 class="card-title">Результат:</h5>
            <p id="result-text" class="card-text" style="white-space: pre-wrap;"></p>
        </div>
    </div>
</div>

<!-- JS превью + AJAX -->
<script>
document.getElementById('file').addEventListener('change', function(event) {
    const preview = document.getElementById('preview');
    const file = event.target.files[0];

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('d-none');
        };
        reader.readAsDataURL(file);
    } else {
        preview.src = "#";
        preview.classList.add('d-none');
    }
});

// Перехват отправки формы
document.getElementById('ocr-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const response = await fetch("/ocr/", {
        method: "POST",
        body: formData
    });

    if (response.ok) {
        const data = await response.json(); // сервер должен вернуть {result: "...", language: "..."}
        document.getElementById('result').classList.remove('d-none');
        document.getElementById('result-text').innerText = data.result;
    } else {
        alert("Ошибка при распознавании");
    }
});
</script>
</body>
</html>
